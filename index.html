<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deals CRM â€¢ Kanban Dashboard</title>
  <style>
    /* -------------------- Root + Theme -------------------- */
    :root{
      --bg: #0b1020;
      --card: rgba(255,255,255,0.08);
      --border: rgba(255,255,255,0.12);
      --text: #e9ecf1;
      --muted: #a8b3c7;
      --accent: #7dd3fc; /* sky */
      --accent2: #a78bfa; /* violet */
      --success: #22c55e;
      --danger: #ef4444;
      --warning: #f59e0b;
      --ring: rgba(125,211,252,0.4);
      --glow: 0 0 0.5rem rgba(167,139,250,0.5), 0 0 2rem rgba(125,211,252,0.35);
    }

    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    html, body { height: 100%; }
    body{
      margin:0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(167,139,250,0.18), transparent 60%),
        radial-gradient(1200px 600px at 110% 110%, rgba(125,211,252,0.18), transparent 60%),
        linear-gradient(120deg, #0b1020 0%, #0e1430 50%, #0b1020 100%);
      background-size: 200% 200%;
      animation: gradientMove 18s ease infinite;
      overflow: hidden;
    }

    /* -------------------- App Layout -------------------- */
    .app{
      display:flex; flex-direction:column; gap:16px;
      height:100vh; padding:16px 16px 0 16px;
    }

    header{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 16px; border:1px solid var(--border);
      border-radius:16px; backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      box-shadow: var(--glow);
      position: relative; isolation:isolate;
    }
    .brand{
      display:flex; align-items:center; gap:12px; font-weight:700;
      letter-spacing:0.3px; font-size:20px;
    }
    .brand .logo{
      width:36px; height:36px; border-radius:12px;
      background: conic-gradient(from 90deg, var(--accent), var(--accent2), #60a5fa, var(--accent));
      border:1px solid var(--border);
      box-shadow: 0 4px 30px rgba(99,102,241,0.35);
      position: relative;
    }
    .actions{ display:flex; align-items:center; gap:10px; }
    .search{
      position:relative; width:280px; max-width: 40vw;
    }
    .search input{
      width:100%; padding:10px 12px 10px 36px; border-radius:12px;
      background: var(--card); border:1px solid var(--border); color:var(--text);
      outline:none; transition: box-shadow .2s, border-color .2s;
    }
    .search input:focus{ box-shadow:0 0 0 6px var(--ring); border-color: var(--accent); }
    .search .icon{ position:absolute; left:10px; top:50%; transform:translateY(-50%); opacity:.7; }

    button.primary{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color:#081018; border:none; padding:10px 14px; border-radius:12px; font-weight:700;
      cursor:pointer; box-shadow: var(--glow);
    }
    button.ghost{
      background: transparent; color: var(--text); border:1px solid var(--border);
      padding:10px 12px; border-radius:12px; cursor:pointer;
    }
    button:active{ transform: translateY(1px); }

    /* -------------------- Board -------------------- */
    .board{
      display:grid; grid-template-columns: repeat(5, minmax(240px, 1fr)); gap:12px;
      height: calc(100vh - 120px); overflow: auto; padding-bottom: 24px;
    }

    .column{
      display:flex; flex-direction:column; gap:10px; padding:12px; border-radius:16px;
      background: rgba(255,255,255,0.06); border:1px solid var(--border); min-height: 280px;
      backdrop-filter: blur(8px); position: relative;
    }
    .column h3{
      margin:0; font-size:14px; letter-spacing:0.4px; text-transform:uppercase; color: var(--muted);
      display:flex; align-items:center; justify-content:space-between;
    }
    .col-dropzone{
      display:flex; flex-direction:column; gap:10px; min-height: 180px;
    }

    .deal{
      background: linear-gradient(180deg, rgba(255,255,255,0.13), rgba(255,255,255,0.06));
      border:1px solid var(--border); border-radius:14px; padding:12px; cursor:grab;
      box-shadow: 0 6px 22px rgba(0,0,0,0.25);
      transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
      position: relative;
    }
    .deal:active{ cursor:grabbing; }
    .deal:hover{ transform: translateY(-2px); box-shadow: 0 10px 28px rgba(0,0,0,0.35); }
    .deal .title{ font-weight:700; }
    .deal .meta{ font-size:12px; color: var(--muted); display:flex; gap:8px; margin-top:6px; }
    .tag{ font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid var(--border); background: rgba(255,255,255,0.06); }

    .drop-hint{ outline: 2px dashed var(--accent); outline-offset: -6px; }

    /* Success & Failure overlays */
    #confettiCanvas{ position: fixed; inset:0; pointer-events:none; z-index: 1000; }
    .toast{
      position: fixed; right: 18px; bottom: 18px; background: rgba(9,15,30,0.9);
      border:1px solid var(--border); padding:10px 14px; border-radius:12px;
      display:flex; align-items:center; gap:8px; box-shadow: var(--glow); z-index: 1100;
    }
    .toast.success{ border-color: rgba(34,197,94,0.5); }
    .toast.error{ border-color: rgba(239,68,68,0.5); }

    /* Shake animation for failure */
    @keyframes shake {
      0%,100%{ transform: translateX(0); }
      20%{ transform: translateX(-6px); }
      40%{ transform: translateX(6px); }
      60%{ transform: translateX(-4px); }
      80%{ transform: translateX(4px); }
    }
    .shake{ animation: shake .4s ease; }

    /* Ringing bell */
    .bell{ position: relative; display:inline-block; transform-origin: top center; }
    .bell.ring{ animation: bellring 1s ease; }
    @keyframes bellring {
      0%{ transform: rotate(0deg); }
      10%{ transform: rotate(12deg); }
      20%{ transform: rotate(-12deg); }
      30%{ transform: rotate(10deg); }
      40%{ transform: rotate(-10deg); }
      50%{ transform: rotate(6deg); }
      60%{ transform: rotate(-6deg); }
      70%{ transform: rotate(3deg); }
      80%{ transform: rotate(-3deg); }
      100%{ transform: rotate(0deg); }
    }

    /* Floating shiny lines */
    .shine{
      position:absolute; inset:0; border-radius:inherit; overflow:hidden; pointer-events:none;
    }
    .shine::before{
      content:""; position:absolute; top:-150%; left:-50%; width:60%; height:400%;
      background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,.15) 50%, transparent 100%);
      transform: rotate(25deg); animation: sweep 8s linear infinite;
    }
    @keyframes sweep{
      0%{ transform: translateX(-120%) rotate(25deg); }
      60%{ transform: translateX(220%) rotate(25deg); }
      100%{ transform: translateX(220%) rotate(25deg); }
    }

    /* Responsive */
    @media (max-width: 1024px){ .board{ grid-template-columns: repeat(3, minmax(240px, 1fr)); } }
    @media (max-width: 720px){ .board{ grid-template-columns: repeat(2, minmax(240px, 1fr)); } .search{ display:none; } }
    @media (max-width: 480px){ .board{ grid-template-columns: 1fr; } header{ gap:10px; } }
  </style>
</head>
<body>
  <canvas id="confettiCanvas"></canvas>
  <div class="app">
    <header>
      <div class="brand" aria-label="Brand">
        <div class="logo"></div>
        <div>
          <div style="font-size:14px; color:var(--muted); line-height:1;">Deals CRM</div>
          <div style="font-size:18px; line-height:1.2;">Kanban Dashboard</div>
        </div>
      </div>
      <div class="actions">
        <div class="search">
          <svg class="icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
          <input id="search" placeholder="Search deals, owners, tagsâ€¦"/>
        </div>
        <button class="ghost" id="addDealBtn">+ New Deal</button>
        <button class="primary" id="saveBtn">Save Board</button>
        <div id="bellWrap" title="Notifications">
          <svg id="bell" class="bell" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M10 21a2 2 0 0 0 4 0"></path>
            <path d="M18 8a6 6 0 1 0-12 0c0 7-3 5-3 9h18c0-4-3-2-3-9Z"></path>
          </svg>
        </div>
      </div>
      <div class="shine"></div>
    </header>

    <main class="board" id="board" aria-label="Kanban Board">
      <!-- Columns -->
      <section class="column" data-col="leads">
        <h3>Leads <span class="count"></span></h3>
        <div class="col-dropzone" role="list"></div>
        <div class="shine"></div>
      </section>
      <section class="column" data-col="qualified">
        <h3>Qualified <span class="count"></span></h3>
        <div class="col-dropzone" role="list"></div>
        <div class="shine"></div>
      </section>
      <section class="column" data-col="proposal">
        <h3>Proposal <span class="count"></span></h3>
        <div class="col-dropzone" role="list"></div>
        <div class="shine"></div>
      </section>
      <section class="column" data-col="won">
        <h3>Won ðŸ¥³ <span class="count"></span></h3>
        <div class="col-dropzone" role="list"></div>
        <div class="shine"></div>
      </section>
      <section class="column" data-col="lost">
        <h3>Lost ðŸ˜¢ <span class="count"></span></h3>
        <div class="col-dropzone" role="list"></div>
        <div class="shine"></div>
      </section>
    </main>
  </div>

  <div id="toasts" aria-live="polite"></div>

  <script>
    // -------------------- Utilities --------------------
    const $ = (s, el=document) => el.querySelector(s);
    const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));

    // Generate ID
    const uid = () => Math.random().toString(36).slice(2,9);

    // Toasts
    function toast(msg, type='success', timeout=2200){
      const t = document.createElement('div');
      t.className = toast ${type};
      t.innerHTML = type==='success'
        ? âœ… <span>${msg}</span>
        : â›” <span>${msg}</span>;
      $('#toasts').appendChild(t);
      setTimeout(()=> t.remove(), timeout);
    }

    // Ring bell animation
    function ringBell(){
      const bell = $('#bell');
      bell.classList.remove('ring');
      void bell.offsetWidth; // restart animation
      bell.classList.add('ring');
    }

    // -------------------- Web Audio (bells & buzzers) --------------------
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playChime(){
      // simple triad ding
      const now = audioCtx.currentTime;
      [880, 1318.5, 1760].forEach((freq, i)=>{
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = 'sine'; o.frequency.value = freq;
        g.gain.setValueAtTime(0.0001, now);
        g.gain.exponentialRampToValueAtTime(0.3/(i+1), now+0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, now+0.6);
        o.connect(g).connect(audioCtx.destination);
        o.start(now + i*0.02);
        o.stop(now + 0.7 + i*0.02);
      });
    }

    function playBuzzer(){
      const now = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type='square'; o.frequency.setValueAtTime(220, now);
      o.frequency.exponentialRampToValueAtTime(120, now+0.3);
      g.gain.setValueAtTime(0.001, now);
      g.gain.exponentialRampToValueAtTime(0.35, now+0.02);
      g.gain.exponentialRampToValueAtTime(0.001, now+0.4);
      o.connect(g).connect(audioCtx.destination);
      o.start(); o.stop(now+0.42);
    }

    // -------------------- Confetti --------------------
    const confettiCanvas = document.getElementById('confettiCanvas');
    const ctx = confettiCanvas.getContext('2d');
    let confettiPieces = [];

    function resizeCanvas(){
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas); resizeCanvas();

    function shootConfetti(x = window.innerWidth/2, y = 80){
      const colors = ['#34d399','#60a5fa','#a78bfa','#f59e0b','#ef4444','#22d3ee','#e879f9'];
      for(let i=0;i<180;i++){
        confettiPieces.push({
          x, y,
          vx: (Math.random()*6-3),
          vy: (Math.random()*-8-4),
          size: Math.random()*6+3,
          color: colors[Math.floor(Math.random()*colors.length)],
          rot: Math.random()*Math.PI,
          vr: (Math.random()*0.2-0.1),
          life: 90 + Math.random()*40
        });
      }
      if(!confettiAnimating) animateConfetti();
    }

    let confettiAnimating = false;
    function animateConfetti(){
      confettiAnimating = true;
      ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
      confettiPieces.forEach(p=>{
        p.vy += 0.18; // gravity
        p.x += p.vx; p.y += p.vy; p.rot += p.vr; p.life -= 1;
        ctx.save();
        ctx.translate(p.x, p.y); ctx.rotate(p.rot);
        ctx.fillStyle = p.color;
        ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6);
        ctx.restore();
      });
      confettiPieces = confettiPieces.filter(p=> p.y < confettiCanvas.height+20 && p.life>0);
      if(confettiPieces.length){ requestAnimationFrame(animateConfetti); }
      else { confettiAnimating = false; }
    }

    // -------------------- Demo Data --------------------
    const demoDeals = [
      { id: uid(), title: 'Acme Corp â€“ Website Revamp', amount: 42000, owner: 'Mahendra', tag: 'Web' },
      { id: uid(), title: 'Sunrise Farms â€“ IoT Sensors', amount: 98000, owner: 'Ravi', tag: 'IoT' },
      { id: uid(), title: 'Coastal Marine â€“ Aqua Bites', amount: 56000, owner: 'Priya', tag: 'Eâ€‘Com' },
      { id: uid(), title: 'QISCET â€“ AI Workshop', amount: 15000, owner: 'Anitha', tag: 'Edu' },
      { id: uid(), title: 'Ongole Nests â€“ PG Listings', amount: 24000, owner: 'Mahendra', tag: 'SaaS' }
    ];

    const columns = ['leads','qualified','proposal','won','lost'];

    // -------------------- Board Operations --------------------
    const boardEl = $('#board');

    function cardTemplate({id, title, amount, owner, tag}){
      const el = document.createElement('article');
      el.className = 'deal';
      el.setAttribute('draggable', 'true');
      el.dataset.id = id;
      el.innerHTML = `
        <div class="title">${title}</div>
        <div class="meta">
          <span class="tag">â‚¹${amount.toLocaleString('en-IN')}</span>
          <span class="tag">Owner: ${owner}</span>
          <span class="tag">${tag}</span>
        </div>
      `;
      addDragHandlers(el);
      return el;
    }

    function updateCounts(){
      $$('.column').forEach(col => {
        const count = col.querySelectorAll('.deal').length;
        col.querySelector('.count').textContent = count;
      });
    }

    function addDragHandlers(card){
      card.addEventListener('dragstart', (e)=>{
        e.dataTransfer.setData('text/plain', card.dataset.id);
        setTimeout(()=> card.classList.add('dragging'), 0);
      });
      card.addEventListener('dragend', ()=>{
        card.classList.remove('dragging');
      });
    }

    function setupColumns(){
      $$('.column').forEach(col => {
        const zone = col.querySelector('.col-dropzone');
        zone.addEventListener('dragover', (e)=>{
          e.preventDefault(); zone.classList.add('drop-hint');
        });
        zone.addEventListener('dragleave', ()=> zone.classList.remove('drop-hint'));
        zone.addEventListener('drop', (e)=>{
          e.preventDefault(); zone.classList.remove('drop-hint');
          const id = e.dataTransfer.getData('text/plain');
          const card = boardEl.querySelector([data-id="${id}"]);
          if(card) zone.appendChild(card);
          const colName = col.dataset.col;
          onCardMoved(card, colName);
          persistBoard();
          updateCounts();
        });
      });
    }

    function onCardMoved(card, colName){
      ringBell();
      if(colName === 'won'){
        playChime();
        shootConfetti(window.innerWidth - 200, 80);
        toast('Deal marked as WON! Great job!','success');
      } else if(colName === 'lost'){
        playBuzzer();
        card.classList.remove('shake');
        void card.offsetWidth; // restart
        card.classList.add('shake');
        toast('Deal moved to Lost. Review & retry.','error');
      } else {
        // soft click
        playClick();
      }
    }

    // subtle click tone
    function playClick(){
      const now = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type='triangle'; o.frequency.setValueAtTime(600, now);
      o.frequency.exponentialRampToValueAtTime(300, now+0.08);
      g.gain.setValueAtTime(0.001, now);
      g.gain.exponentialRampToValueAtTime(0.15, now+0.01);
      g.gain.exponentialRampToValueAtTime(0.001, now+0.12);
      o.connect(g).connect(audioCtx.destination);
      o.start(); o.stop(now+0.14);
    }

    function renderDemo(){
      const leadsZone = $('[data-col="leads"] .col-dropzone');
      demoDeals.forEach(d => leadsZone.appendChild(cardTemplate(d)));
      updateCounts();
    }

    // -------------------- Search --------------------
    $('#search').addEventListener('input', (e)=>{
      const q = e.target.value.toLowerCase();
      $$('.deal').forEach(card => {
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(q) ? '' : 'none';
      });
    });

    // -------------------- Add Deal --------------------
    $('#addDealBtn').addEventListener('click', ()=>{
      const title = prompt('Deal title'); if(!title) return;
      const amount = Number(prompt('Amount (INR)') || 0);
      const owner = prompt('Owner') || 'Unassigned';
      const tag = prompt('Tag') || 'General';
      const deal = { id: uid(), title, amount, owner, tag };
      const zone = $('[data-col="leads"] .col-dropzone');
      zone.prepend(cardTemplate(deal));
      updateCounts();
      playClick(); ringBell(); toast('New deal added to Leads','success');
      persistBoard();
    });

    // -------------------- Save / Load (localStorage) --------------------
    function persistBoard(){
      const data = {};
      $$('.column').forEach(col =>{
        data[col.dataset.col] = $$(.deal, col).map(card => card.dataset.id);
      });
      // store deals meta once
      const dealsMeta = {};
      $$('.deal').forEach(card =>{
        const [titleEl, metaEl] = [card.querySelector('.title'), card.querySelector('.meta')];
        const price = metaEl.querySelectorAll('.tag')[0].textContent.replace(/[â‚¹,]/g,'').trim();
        const owner = metaEl.querySelectorAll('.tag')[1].textContent.replace('Owner:','').trim();
        const tag = metaEl.querySelectorAll('.tag')[2].textContent.trim();
        dealsMeta[card.dataset.id] = { title: titleEl.textContent.trim(), amount: Number(price), owner, tag };
      });
      localStorage.setItem('kanban:layout', JSON.stringify(data));
      localStorage.setItem('kanban:deals', JSON.stringify(dealsMeta));
    }

    function loadBoard(){
      const layout = JSON.parse(localStorage.getItem('kanban:layout')||'null');
      const dealsMeta = JSON.parse(localStorage.getItem('kanban:deals')||'null');
      if(!layout || !dealsMeta){ renderDemo(); return; }
      Object.entries(layout).forEach(([col, ids])=>{
        const zone = $([data-col="${col}"] .col-dropzone);
        ids.forEach(id => {
          const meta = dealsMeta[id];
          if(meta) zone.appendChild(cardTemplate({ id, ...meta }));
        });
      });
      updateCounts();
    }

    $('#saveBtn').addEventListener('click', ()=>{
      persistBoard(); ringBell(); playChime(); shootConfetti(); toast('Board saved locally!','success');
    });

    // -------------------- Init --------------------
    function init(){
      setupColumns();
      loadBoard();
    }
    init();

  </script>
</body>
</html>
